sap.ui.define(["../controller/RichEditorBase.controller","../modules/assetLoader","../modules/platform","../modules/util","../config","shortpoint-libs/js/shortpoint.min","shortpoint-libs/js/shortpoint.inserter.min","../modules/l/lm","../modules/l/settings"],function(a,b,c,d,e,f,g,h,i){"use strict";var j=f.util;return a.extend(e.namespace+".controller.EditMode",{onInit:function(){a.prototype.onInit.apply(this,arguments),this.retrieveContent(),this.oRender=jQuery.Deferred();var d=c.isRtl(),e=jQuery.sap.getModulePath("shortpoint-libs","/css/shortpoint.inserter-{dir}.min.css");b.loadCss(e.replace(/{dir}/,d?"rtl":"ltr")),this.oRender.done(this.initInserter.bind(this)),this.subscribe("editReady",function(){this.setContent(this.oComponent.getModelData())},this),this.subscribe("editStart",function(){this.get$Element("shortpoint").addClass("shortpoint-editor-on")},this),this.subscribe("editEnd",function(){this.get$Element("shortpoint").removeClass("shortpoint-editor-on")},this),window.edit=window.edit||[],window.edit.push(this)},get$Editor:function(){return this.get$Element("shortpointEditor")},getContent:function(){return null==g._isInitiated?"":g.platform.adapter.getContent()},setContent:function(a){null!=g._isInitiated&&g.platform.adapter.setContent(a)},onAfterRendering:function(){this.oRootElement=this.getElement("shortpoint"),this.renderWidget(),setTimeout(function(){this.oRender.resolve()}.bind(this),1e3),this.publish("editReady")},exitEditMode:function(a){var b=this,c=g.$;jQuery(a).closest(".widget").removeClass("hide-menu-force"),g.display.destroyAllDisplayWithin(c(a)),this.publish("insert"),this.oComponent.saveContent(b.getContent()).done(function(){b.oComponent.navigateTo("render").done(function(){b.publish("refreshRender")})})},onEditButtonPress:function(){this.publish("editStart"),h.c(),"undefined"!=typeof g&&(g.display.init(),j.defer(function(){g.display.replace()},100)),this.get$Editor().focus(),jQuery(this.oRootElement).closest(".widget").addClass("hide-menu-force")},initInserter:function(){var a=g.$,b={},c={},h={"Design-1.html":110,"Support.html":100,"Team.html":90,"Events.html":80,"Help.html":70},k=window.shortpoint_demo_content.sort(function(a,b){return h[b.name]-h[a.name]});j.each(k,function(a){b[a.name]=a.name.replace(".html","").replace("-"," "),c[a.name]=a.content}),a.FroalaEditor.DefineIconTemplate("feedback_icon",'<a class="shortpoint-custom-cmd" href="http://support.shortpoint.com/support/tickets/new" target="_blank"><i class="shortpoint-icon shortpoint-icon-simple-earphones-alt"></i>Feedback &nbsp;&nbsp;</a>'),a.FroalaEditor.DefineIcon("feedbackIcon",{NAME:"feedbackIcon",template:"feedback_icon"}),a.FroalaEditor.RegisterCommand("feedback",{title:"We are listening, tell us your Feedback",icon:"feedbackIcon",focus:!1,undo:!1}),a.FroalaEditor.DefineIconTemplate("logo_icon",'<a class="shortpoint-custom-cmd" href="//shortpoint.com/sap" target="_blank"><div class="fr-logo-image"></div><div class="fr-btn-text fr-btn-text-small"> '+f.sap.version+" &nbsp;&nbsp;</div></a>"),a.FroalaEditor.DefineIcon("logoIcon",{NAME:"logoIcon",template:"logo_icon"}),a.FroalaEditor.RegisterCommand("logo",{title:"ShortPoint site",icon:"logoIcon",focus:!1,undo:!1}),a.FroalaEditor.DefineIconTemplate("upgrade_icon",'<a class="shortpoint-custom-cmd" href="http://support.shortpoint.com/support/solutions/articles/1000231576" target="_blank"><i class="shortpoint-icon shortpoint-icon-fa-cloud-download"></i>Upgrade &nbsp;&nbsp;</a>'),a.FroalaEditor.DefineIcon("upgradeIcon",{NAME:"upgradeIcon",template:"upgrade_icon"}),a.FroalaEditor.RegisterCommand("upgrade",{title:"A New version is available",icon:"upgradeIcon",focus:!1,undo:!1,refresh:function(){}}),a.FroalaEditor.DefineIconTemplate("account_settings",'<div class="shortpoint-custom-cmd" href="javascript:void(0)"><i class="shortpoint-icon-ion shortpoint-icon-ion-android-settings"></i></div>'),a.FroalaEditor.DefineIcon("account_settings_icon",{NAME:"settings",template:"account_settings"}),a.FroalaEditor.RegisterCommand("accountSettings",{title:"Account Settings",icon:"account_settings_icon",focus:!0,refreshAfterCallback:!1,callback:function(a,b){i.show()}}),a.FroalaEditor.DefineIconTemplate("demo_content_template",'<div class="shortpoint-custom-cmd" href="javascript:void(0)"><i class="shortpoint-icon-fa shortpoint-icon-fa-magic"></i></div>'),a.FroalaEditor.DefineIcon("demo_content_icon",{NAME:"magic",template:"demo_content_template"}),a.FroalaEditor.RegisterCommand("demoContent",{title:"Some nicely designed content for you, try them out for some inspiration!",type:"dropdown",icon:"demo_content_icon",focus:!0,undo:!0,options:b,refreshAfterCallback:!1,callback:function(b,d){var e=c[d];e&&(this.html.set(e.replace(/&#xA0;/g,"")),g.display.init(this.$box.find(".fr-view")),this.$box.find(".shortpoint-display-actions, .shortpoint-display-actions *, .shortpoint-display-toolbar, .shortpoint-display-before *, .shortpoint-display-after *").attr("unselectable","on"),this.$box.find(".shortpoint-col").each(function(){var b=a(this),c=b.parent();b.insertAfter(c),c.remove()}))}}),a.FroalaEditor.DefineIconTemplate("save_icon",'<i class="shortpoint-icon-fa shortpoint-icon-fa-save"></i>'),a.FroalaEditor.DefineIcon("saveShortPoint",{NAME:"saveShortPoint",template:"save_icon"}),a.FroalaEditor.RegisterCommand("saveShortPoint",{title:"Save",icon:"saveShortPoint",focus:!0,undo:!0,refreshAfterCallback:!0,callback:function(){var a=this.$box;g.platform.adapter.setActiveEditor(this);try{var b=jQuery(a).closest(".shortpoint-root-view").parent(),c=sap.ui.getCore().byId(b.attr("id")),d=c.getController();d.exitEditMode(a.find(".fr-view"))}catch(e){g.error("could not get a reference to view from a DOM element"),g.error(e)}}});var l=["insertShortPoint","insertSection","saveShortPoint","demoContent","accountSettings"],m=g.rte.getToolbar("full"),n=l.concat(["logo","feedback","upgrade","-"],m);this.editor=new g.Editor(this.get$Editor(),{heightMin:400,toolbarButtons:n,toolbarButtonsMD:n,toolbarButtonsSM:n,toolbarButtonsXS:n});this.editor.instance;a(this.get$Editor()).on("froalaEditor.initialized",function(){setTimeout(function(){a(window).trigger("resize")},100)}),null==g._isInitiated&&(g.init(),g._isInitiated=!0),this.setContent(this.oComponent.getModelData()),d.newVersionAvailable(e.appVersion,function(a,b){return a?void g.warn("error checking for new version of shortpoint: "+a):void(b&&(document.documentElement.className+=" shortpoint-upgrade-available"))})},renderWidget:function(){var a=this.oComponent.getModelData();a&&this.setContent(a)}})});