sap.ui.define(["../controller/RichEditorBase.controller","../modules/assetLoader","../modules/platform","../modules/util","../config","shortpoint-libs/js/shortpoint.min"],function(a,b,c,d,e,f){"use strict";var g=f.util;return a.extend(e.namespace+".controller.EditMode",{onInit:function(){if(a.prototype.onInit.apply(this,arguments),this.inserterInited=!1,this.oRender=jQuery.Deferred(),!c.isRuntimeMode()&&!c.isPreviewMode()){var d=c.isRtl(),e=jQuery.sap.getModulePath("shortpoint-libs","/css/shortpoint.inserter-{dir}.min.css");b.loadCss(e.replace(/{dir}/,d?"rtl":"ltr")),this.subscribe("editReady",function(){this.setContent(this.oComponent.getModelData())},this),this.subscribe("editStart",function(){this.get$Element("shortpoint").addClass("shortpoint-editor-on")},this),this.subscribe("editEnd",function(){this.get$Element("shortpoint").removeClass("shortpoint-editor-on")},this),f.subscribe("newLicenseInfo",function(){try{this.updateLicenseInfoBox.apply(this,arguments)}catch(a){this.shortPointInserter.error.verbose(a)}},this),window.shortpointEdit=window.shortpointEdit||[],window.shortpointEdit.push(this)}},editModeInit:function(){this.retrieveContent(),this.oRender.done(this.initInserter.bind(this))},updateLicenseInfoBox:function(a){var b=this.get$Element("shortpointEditor").find('[data-cmd="licenseInfo"]'),c=b.children(),d=!1,e="sp-inserter-alert-danger sp-inserter-alert-success sp-inserter-alert-warning sp-inserter-alert-info",f='<i class="shortpoint-icon shortpoint-icon-fa shortpoint-icon-fa-times-circle"></i>',g=f+"Your license has expired. <a><strong>Activate Now!</strong></a>",h=function(){settingsModule.show(!0)};$(document.documentElement).attr("data-shortpoint-lt",(a.licenseType+"").toLowerCase()),a.isValid||(c.removeClass(e),c.addClass("sp-inserter-alert-danger"),c.html(g),c.find("a").on("click",h),d=!0),$("html").toggleClass("spi-license-info-show",d)},get$Editor:function(){return this.get$Element("shortpointEditor")},getContent:function(){return null==this.shortPointInserter._isInitiated?"":this.shortPointInserter.platform.adapter.getContent()},setContent:function(a){if(this.shortPointInserter&&null!=this.shortPointInserter._isInitiated){var b=this.get$Editor();b.length&&b.hasClass("fr-box")&&this.shortPointInserter.platform.adapter.setContent(a)}},onAfterRendering:function(){this.oRootElement=this.getElement("shortpoint"),this.renderWidget(),setTimeout(function(){this.oRender.resolve()}.bind(this),1e3),this.publish("editReady")},exitEditMode:function(a){var b=this,c=this.shortPointInserter.$;jQuery(a).closest(".widget").removeClass("hide-menu-force"),this.shortPointInserter.display.destroyAllDisplayWithin(c(a)),this.publish("insert"),this.oComponent.saveContent(b.getContent()).done(function(){b.oComponent.navigateTo("render").done(function(){b.publish("refreshRender")})})},onEditButtonPress:function(){var a=this;sap.ui.require(["shortpoint-libs/js/shortpoint.inserter.min","shortpoint-libs/js/settings","shortpoint-libs/js/lm"],function(b,c,d){a.shortPointInserter=b,a.settingsModule=c,a.licenseManager=d,a.inserterInited||(a.editModeInit(),a.inserterInited=!0),a.publish("editStart"),a.licenseManager.c(),"undefined"!=typeof b&&(b.display.init(),g.defer(function(){b.display.replace()},100)),a.get$Editor().focus(),jQuery(a.oRootElement).closest(".widget").addClass("hide-menu-force")})},initInserter:function(){var a=this.shortPointInserter.$;a.FroalaEditor.DefineIconTemplate("feedback_icon",'<a class="shortpoint-custom-cmd shortpoint-editor-gray-label" href="http://support.shortpoint.com/support/tickets/new" target="_blank"><i class="shortpoint-icon-ion shortpoint-icon-ion-help-circled"></i><label>Do you need help?&nbsp;</label></a>'),a.FroalaEditor.DefineIcon("feedbackIcon",{NAME:"feedbackIcon",template:"feedback_icon"}),a.FroalaEditor.RegisterCommand("feedback",{title:"We are here to help. Ask us anything!",icon:"feedbackIcon",focus:!1,undo:!1}),a.FroalaEditor.DefineIconTemplate("logo_icon",'<a class="shortpoint-custom-cmd" href="http://shortpoint.com/sap" target="_blank"><div class="fr-logo-image"></div><div class="fr-btn-text fr-btn-text-small"> '+f.sap.version+" &nbsp;&nbsp;</div></a>"),a.FroalaEditor.DefineIcon("logoIcon",{NAME:"logoIcon",template:"logo_icon"}),this.shortPointInserter.rte.registerCommand("logo",{title:"ShortPoint site",icon:"logoIcon",focus:!1,undo:!1}),a.FroalaEditor.DefineIconTemplate("upgrade_icon",'<a class="shortpoint-custom-cmd" href="http://support.shortpoint.com/support/solutions/articles/1000231576" target="_blank"><i class="shortpoint-icon shortpoint-icon-fa-cloud-download"></i>Upgrade &nbsp;&nbsp;</a>'),a.FroalaEditor.DefineIcon("upgradeIcon",{NAME:"upgradeIcon",template:"upgrade_icon"}),this.shortPointInserter.rte.registerCommand("upgrade",{title:"A New version is available",icon:"upgradeIcon",focus:!1,undo:!1,refresh:function(){}}),a.FroalaEditor.DefineIconTemplate("account_settings",'<div class="shortpoint-custom-cmd" href="javascript:void(0)"><i class="shortpoint-icon-ion shortpoint-icon-ion-android-settings"></i></div>'),a.FroalaEditor.DefineIcon("account_settings_icon",{NAME:"settings",template:"account_settings"}),this.shortPointInserter.rte.registerCommand("accountSettings",{title:"Account Settings",icon:"account_settings_icon",focus:!0,refreshAfterCallback:!1,callback:function(a,b){settingsModule.show()}}),a.FroalaEditor.DefineIconTemplate("license_info_template",'<div class="spi-license-info"></div>'),a.FroalaEditor.DefineIcon("license_info_icon",{NAME:"none",template:"license_info_template"}),this.shortPointInserter.rte.registerCommand("licenseInfo",{title:null,icon:"license_info_icon",focus:!1,undo:!1,refreshAfterCallback:!1}),a.FroalaEditor.DefineIconTemplate("demo_content_template",'<div class="shortpoint-custom-cmd" href="javascript:void(0)"><i class="shortpoint-icon-fa shortpoint-icon-fa-magic"></i></div>'),a.FroalaEditor.DefineIcon("demo_content_icon",{NAME:"magic",template:"demo_content_template"}),a.FroalaEditor.DefineIconTemplate("save_icon",'<i class="shortpoint-icon-fa shortpoint-icon-fa-save"></i>'),a.FroalaEditor.DefineIcon("saveShortPoint",{NAME:"saveShortPoint",template:"save_icon"}),this.shortPointInserter.rte.registerCommand("saveShortPoint",{title:"Save",icon:"saveShortPoint",focus:!0,undo:!0,refreshAfterCallback:!0,callback:function(){var a=this.$box;shortPointInserter.platform.adapter.setActiveEditor(this);try{var b=jQuery(a).closest(".shortpoint-root-view").parent(),c=sap.ui.getCore().byId(b.attr("id")),d=c.getController();d.exitEditMode(a.find(".fr-view"))}catch(e){shortPointInserter.error("could not get a reference to view from a DOM element"),shortPointInserter.error(e)}}});var b=["licenseInfo","insertShortPoint","insertSection","saveShortPoint","demoContent"],c=this.shortPointInserter.rte.getToolbar("full"),g=b.concat(["logo","feedback","upgrade","accountSettings","-"],c);this.editor=new this.shortPointInserter.Editor(this.get$Editor(),{heightMin:400,toolbarButtons:g,toolbarButtonsMD:g,toolbarButtonsSM:g,toolbarButtonsXS:g}),a(this.get$Editor()).on("froalaEditor.initialized",function(){setTimeout(function(){a(window).trigger("resize")},100)}),null==this.shortPointInserter._isInitiated&&(this.shortPointInserter.init(),this.shortPointInserter._isInitiated=!0),this.setContent(this.oComponent.getModelData()),d.newVersionAvailable(e.appVersion,function(a,b){return a?void this.shortPointInserter.warn("error checking for new version of shortpoint: "+a):void(b&&(document.documentElement.className+=" shortpoint-upgrade-available"))})},renderWidget:function(){var a=this.oComponent.getModelData();a&&this.setContent(a)}})});