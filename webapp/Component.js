sap.ui.define(["sap/ui/core/UIComponent","./config","sap/ui/Device","./model/models","./modules/assetLoader","./modules/platform","./modules/pubsub","./libs/js/shortpoint.min"],function(a,b,c,d,e,f,g,h){"use strict";var i=h.util;return a.extend([b.namespace,"Component"].join("."),{metadata:{manifest:"json"},init:function(){a.prototype.init.apply(this,arguments),this.setModel(d.createDeviceModel(),"device"),this.oSaveDone=jQuery.Deferred(),this.oRouterInitialized=jQuery.Deferred(),this.oSettingsDone=jQuery.Deferred(),this.registerShortPointPreConfig(),window.shortpoint=window.shortpoint||{},window.shortpoint.sap={},this.oConfig=this.getMetadata().getConfig().shortpoint,this.sVersion=this.getMetadata().getManifest()["sap.app"].applicationVersion.version,this.loadShortPoint(),f.isWebIDEMode()&&this.createEditButton(),window.com=window.com||[],window.com.push(this)},registerShortPointPreConfig:function(){this.updateThemeParameters()},createEditButton:function(){var a=jQuery("<button>").addClass("ide-edit-button").text("edit").appendTo("body"),b=this;a.on("click",function(a){b.onEditButtonPress.call(b,a)})},updateThemeParameters:function(){var a,b=f.getThemeParam("sapButton_BorderWitdh")||f.getThemeParam("sapButton_BorderWidth"),c=f.getThemeParam("sapButton_BorderCornerRadius"),d=f.getThemeParam("sapBrandColor"),e=f.getThemeParam("sapButton_BorderColor");a="undefined"!=typeof h&&h.config?h.config:window.shortpoint_pre_config,a.colors=a.colors||{},a.colors.primary=d,a.colors.border=e,a.corners=c,a.border=a.border||{},a.border.size=b},onConfigChange:function(){this.publish("configChange");var a=new sap.ui.model.json.JSONModel,b=this.getMetadata().getManifest()["sap.cloud.portal"];b&&b.settings&&(b["sap.cloud.portal"]||(a.setData(this.getMetadata().getManifest()["sap.cloud.portal"].settings),this.oSaveDone.resolve(),this.onSettingsModelInit(a)))},onSettingsModelInit:function(a){if(a){var b=this.getModel("settings");if(b)return void b.setData(a.getData());var c=this,d=new sap.ui.model.Binding(a,"/",a.getContext("/"));d.attachChange(function(){c.onSettingsChange()}),this.setModel(a,"settings"),this.oRouterInitialized.resolve(),this.oSettingsDone.resolve(a.getData())}},onSettingsChange:function(){var a=this.getAggregation("rootControl"),b=this.getModel("settings"),c=b.getData(),d=c.markup.value;a.setContent(d)},getData:function(){return this.oSettingsDone},onEditButtonPress:function(a){this.navigateTo("edit").done(function(b){b.onEditButtonPress(a)}),f.hideWidgetMenu()},loadShortPoint:function(){e.setVersion(this.sVersion);var a=f.getSAPModulePath(),b=f.isRtl();e.loadCss(a+"/libs/css/shortpoint-engine-{dir}.min.css".replace(/{dir}/,b?"rtl":"ltr"))},navigateTo:function(a){var b,c,d=this.getAggregation("rootControl"),e=d.byId("renderMode"),f=d.byId("editMode"),g=jQuery.Deferred();return"edit"===a?(b=f,c=e):"render"===a&&(b=e,c=f),c.$().hide(),b.$().show(),i.defer(function(){g.resolve(b.getController())},100),g},getModelData:function(){return f.isWebIDEMode()?window.shortpointContent||'[info color="warning"]Hello SAP[/info]':this.getModel("settings").getData().markup.value},saveContent:function(a){return this.oSaveDone=jQuery.Deferred(),this.fireEvent("save.settings",{markup:{value:a}}),f.isWebIDEMode()&&(window.shortpointContent=a,i.defer(function(){this.oSaveDone.resolve()},this)),this.oSaveDone},createContent:function(){return this.view=sap.ui.view({viewName:b.namespace+".view.App",type:sap.ui.core.mvc.ViewType.XML,async:!0}),this.view},publish:function(a,b){return g.publish(a,b,this)},subscribe:function(a,b,c){return g.subscribe(a,b,c,this)},unsubscribe:function(a,b,c){return g.unsubscribe(a,b,c,this)}})});